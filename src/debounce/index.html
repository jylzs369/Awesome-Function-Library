<template id="debounce">
    <h1>去抖函数</h1>
    <section class="function">
        <div>待执行函数：
            <pre>
                <code>
            () => {
                paras[index - 1].innerHTML += ' 执行的内容'
            }
                </code>
            </pre>
        </div>
        <h2>方法一：</h2>
        <pre>
            <button id="debounce1">尝试</button>
            <code>
            // 简单debounce函数
            const simpleDebounce = function () {
                let timer = null
                return function (fn, timeout) {
                    if (timer) clearTimeout(timer)
                    timer = setTimeout(fn, timeout)
                }
            }()

            // 按钮触发事件
            simpleDebounce(() => {
                paras[index - 1].innerHTML += ' 执行的内容'
                count = 0
            }, 1000)
            </code>
        </pre>
        <h2>方法二：</h2>
        <pre>
            <button id="debounce2">尝试</button>
            <code>
            </code>
        </pre>
    </section>
    <section class="display">
        <h3>方法一：</h3>
        <p></p>
        <h3>方法二：</h3>
        <p></p>
        <h3>方法三：</h3>
        <p></p>
    </section>
</template>
 
<script>
// 定义<function-shuffle>
class HTMLFunctionDebounceElement extends HTMLElement {
    constructor() {
        super()
        this.innerHTML = document.currentScript.ownerDocument.querySelector('#debounce').innerHTML;
    }
};
// 注册
customElements.define('function-debounce', HTMLFunctionDebounceElement);
</script>

<script>
(function () {
    // 简单debounce函数
    const simpleDebounce = function () {
        let timer = null
        return function (fn, wait) {
            timer && clearTimeout(timer)
            console.log(timer)
            timer = setTimeout(fn, wait)
        }
    }()
    
    // 可配置第一次是否立即执行debounce函数，
    const immediateDebounce = function () {
        let timer = null
        return function (fn, wait, immediate) {
            immediate && !timer && fn()
            timer && clearTimeout(timer)
            timer = setTimeout(fn, wait)
        }
    }()

    function debounce (func, wait, immediate) {
        var timeout, args, context, timestamp, result;

        var later = function() {
            console.log(1)
            var last = new Date().getTime() - timestamp; // timestamp会实时更新

            if (last < wait && last >= 0) {
                timeout = setTimeout(later, wait - last);
            } else {
                timeout = null;
                if (!immediate) {
                    result = func.apply(context, args);
                    if (!timeout) context = args = null;
                }
            }
        };

        return function() {
            context = this;
            args = arguments;
            timestamp = new Date().getTime();
            var callNow = immediate && !timeout;

            if (!timeout) {
                timeout = setTimeout(later, wait);
            }
            if (callNow) {
                result = func.apply(context, args);
                context = args = null;
            }
            return result;
        };
    }
    const paras = document.querySelectorAll('function-debounce p')
    let count = 0
    document.querySelector('function-debounce .function').addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            let index = e.target.id.slice(-1)
            paras[index - 1].innerHTML = ++count
            if (e.target.id === 'debounce1') {
                simpleDebounce(() => {
                    paras[index - 1].innerHTML += ' 执行的内容'
                    count = 0
                }, 1000)
            }
            if (e.target.id === 'debounce2') {
                debounce(function () {
                    paras[index - 1].innerHTML += ' 执行的内容'
                    count = 0
                }, 1000, true)
            }
        }
    }, false)
})()
</script>

<!-- <script src="debounce.js"></script> --> 